{% load i18n %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% trans "Seat Selection" %}</title>
    <!-- Link to your global CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body class="seat-selection-body" style="margin:0; padding:0;">

<!-- Navbar -->
<nav class="navbar">
    <div class="logo">
        <a href="{% url 'home' %}">
            <img src="{% static 'images/logo3.png' %}" alt="Cinema Logo" style="height:70px;">
        </a>
    </div>
    <ul class="nav-links">
        <li><a href="{% url 'home' %}">Home</a></li>
        <li><a href="{% url 'cinema' %}">Events/Cinema</a></li>
        <li><a href="{% url 'streaming:streaming_home' %}">Streaming</a></li>
        <li><a href="{% url 'about' %}">About</a></li>
        <li><a href="{% url 'contact' %}">Contact</a></li>

        {% if user.is_authenticated %}
            <li>
                <a href="{% url 'streaming:user_profile' %}" class="profile-btn">
                    {% if profile and profile.profile_picture %}
                        <img src="{{ profile.profile_picture.url }}" alt="{{ user.username }}" class="profile-img">
                    {% else %}
                        <i class="fas fa-user-circle"></i>
                    {% endif %}
                    {{ user.username }}
                </a>
            </li>
            <li><a href="{% url 'streaming:logout' %}" class="logout-btn">Logout</a></li>
        {% else %}
            <li><a href="{% url 'streaming:login' %}" class="login-btn">Login</a></li>
            <li><a href="{% url 'streaming:signup' %}" class="signup-btn">Sign Up</a></li>
        {% endif %}
    </ul>


</nav>


    <!-- Add top spacing so content is not hidden behind fixed navbar -->
    <h1 style="margin-top:100px; text-align:center;">
        {% blocktrans with title=movie.title %}Seat Selection for {{ title }}{% endblocktrans %}
    </h1>

    <div class="seat-selection-form">
    <form method="POST">
        {% csrf_token %}
        <div>
            <label for="name">{% trans "Your Name:" %}</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div>
            <label for="email">{% trans "Your Email:" %}</label>
            <input type="email" id="email" name="email" required>
        </div>

        <div>
            <label for="seat_id">{% trans "Select Seat:" %}</label>
            <select name="seat_id" id="seat_id" required>
                {% for seat in seats %}
                    <option value="{{ seat.id }}" {% if seat.is_booked %}disabled{% endif %}>
                        {% blocktrans with seatnum=seat.seat_number %}Seat {{ seatnum }}{% endblocktrans %}
                        {% if seat.is_booked %}- {% trans "Booked" %}{% endif %}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="amount">{% trans "Payment Amount (ETB):" %}</label>
            <input type="number" id="amount" name="amount" value="{{ ticket_price }}" readonly>
        </div>

        <button type="submit">{% trans "Confirm Reservation & Pay" %}</button>
    </form>

        {% if error %}
            <div class="error-message">{{ error }}</div>
        {% endif %}
    </div>

    <div class="seats-container">
        {% for seat in seats %}
            <div class="seat {% if seat.is_booked %}booked{% endif %}" data-seat-id="{{ seat.id }}" onclick="selectSeat({{ seat.id }}, {{ seat.is_booked|yesno:'true,false' }}, this)">
                {% if not seat.is_booked %}
                    {% blocktrans with seatnum=seat.seat_number %}Seat {{ seatnum }}{% endblocktrans %}
                {% else %}
                    <span>{% trans "Booked" %}</span>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <!-- Popup for booked seat -->
    <div class="popup" id="popup">
        <div class="popup-content">
            <p>{% trans "Sorry, this seat is already booked. Please select another available seat." %}</p>
            <button onclick="closePopup()">{% trans "Close" %}</button>
        </div>
    </div>
<!-- Footer -->
<footer class="site-footer" style="margin-top:50px;">
    <div class="footer-content">
        <div class="social-icons">
            <a href="https://facebook.com" target="_blank" aria-label="Facebook">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a href="https://twitter.com" target="_blank" aria-label="Twitter">
                <i class="fab fa-twitter"></i>
            </a>
            <a href="https://instagram.com" target="_blank" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </div>
    </div>
    <p>&copy; Qine Entertainment 2025. All rights reserved.</p>
</footer>

    <!-- Link to your global JS -->
    <script src="{% static 'js/scripts.js' %}"></script>
    <script>
        // Seat selection with highlight
        let selectedSeat = null;

        function selectSeat(seatId, isBooked, element) {
            if (isBooked) {
                showPopup();
            } else {
                if (selectedSeat) {
                    selectedSeat.classList.remove('selected-seat');
                }
                element.classList.add('selected-seat');
                selectedSeat = element;

                document.getElementById('seat_id').value = seatId;
            }
        }

        function showPopup() {
            document.getElementById('popup').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }
    </script>
</body>
</html>
