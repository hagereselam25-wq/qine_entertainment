{% load i18n %}
{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% trans "Seat Selection" %}</title>
    <!-- Link to your global CSS -->
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
</head>
<body class="seat-selection-body">

    <!-- Navbar -->
    <nav class="navbar">
        <div class="logo">Cinema</div>
        <ul class="nav-links">
            <li><a href="{% url 'home' %}">{% trans "Home" %}</a></li>
            <li><a href="{% url 'streaming:login' %}" class="login-btn">{% trans "Login" %}</a></li>
        </ul>
    </nav>

    <h1>{% blocktrans with title=movie.title %}Seat Selection for {{ title }}{% endblocktrans %}</h1>

    <div class="seat-selection-form">
    <form method="POST">
        {% csrf_token %}
        <div>
            <label for="name">{% trans "Your Name:" %}</label>
            <input type="text" id="name" name="name" required>
        </div>

        <div>
            <label for="email">{% trans "Your Email:" %}</label>
            <input type="email" id="email" name="email" required>
        </div>

        <div>
            <label for="seat_id">{% trans "Select Seat:" %}</label>
            <select name="seat_id" id="seat_id" required>
                {% for seat in seats %}
                    <option value="{{ seat.id }}" {% if seat.is_booked %}disabled{% endif %}>
                        {% blocktrans with seatnum=seat.seat_number %}Seat {{ seatnum }}{% endblocktrans %}
                        {% if seat.is_booked %}- {% trans "Booked" %}{% endif %}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div>
            <label for="amount">{% trans "Payment Amount (ETB):" %}</label>
            <input type="number" id="amount" name="amount" min="1" step="0.01" placeholder="{% trans 'Enter payment amount' %}" required>
        </div>

        <button type="submit">{% trans "Confirm Reservation & Pay" %}</button>
    </form>

        {% if error %}
            <div class="error-message">{{ error }}</div>
        {% endif %}
    </div>

    <div class="seats-container">
        {% for seat in seats %}
            <div class="seat {% if seat.is_booked %}booked{% endif %}" data-seat-id="{{ seat.id }}" onclick="selectSeat({{ seat.id }}, {{ seat.is_booked|yesno:'true,false' }}, this)">
                {% if not seat.is_booked %}
                    {% blocktrans with seatnum=seat.seat_number %}Seat {{ seatnum }}{% endblocktrans %}
                {% else %}
                    <span>{% trans "Booked" %}</span>
                {% endif %}
            </div>
        {% endfor %}
    </div>

    <!-- Popup for booked seat -->
    <div class="popup" id="popup">
        <div class="popup-content">
            <p>{% trans "Sorry, this seat is already booked. Please select another available seat." %}</p>
            <button onclick="closePopup()">{% trans "Close" %}</button>
        </div>
    </div>

    <!-- Link to your global JS -->
    <script src="{% static 'js/scripts.js' %}"></script>
    <script>
        // Seat selection with highlight
        let selectedSeat = null;

        function selectSeat(seatId, isBooked, element) {
            if (isBooked) {
                showPopup();
            } else {
                if (selectedSeat) {
                    selectedSeat.classList.remove('selected-seat');
                }
                element.classList.add('selected-seat');
                selectedSeat = element;

                document.getElementById('seat_id').value = seatId;
            }
        }

        function showPopup() {
            document.getElementById('popup').style.display = 'flex';
        }

        function closePopup() {
            document.getElementById('popup').style.display = 'none';
        }
    </script>
</body>
</html>