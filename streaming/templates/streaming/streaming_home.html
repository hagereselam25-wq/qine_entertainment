{% load i18n %}
{% load static %}

{% block content %}
<head>
    <title>Cinema Reservation</title>
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <script src="{% static 'js/scripts.js' %}" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
</head>

<h1 class="streaming-header">Streaming Content</h1>
<nav class="navbar">
    <div class="logo">
        <a href="{% url 'home' %}">
            <img src="{% static 'images/logo3.png' %}" alt="Cinema Logo" style="height:70px;">
        </a>
    </div>
    <ul class="nav-links">
        <li><a href="{% url 'home' %}">Home</a></li>
        <li><a href="{% url 'cinema' %}">Events/Cinema</a></li>
        <li><a href="{% url 'streaming:streaming_home' %}">Streaming</a></li>
        <li><a href="{% url 'about' %}">About</a></li>
        <li><a href="{% url 'contact' %}">Contact</a></li>

        {% if user.is_authenticated %}
            <li>
                <a href="{% url 'streaming:user_profile' %}" class="profile-btn">
                    {% if profile and profile.profile_picture %}
                        <img src="{{ profile.profile_picture.url }}" alt="{{ user.username }}" class="profile-img">
                    {% else %}
                        <i class="fas fa-user-circle"></i>
                    {% endif %}
                    {{ user.username }}
                </a>
            </li>
            <li><a href="{% url 'streaming:logout' %}" class="logout-btn">Logout</a></li>
            <!-- Google Translate -->
<div id="google_translate_element" style="text-align:right; margin:10px 20px;"></div>
<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
      pageLanguage: 'en', 
      includedLanguages: 'am,ti,om', 
      layout: google.translate.TranslateElement.InlineLayout.SIMPLE
  }, 'google_translate_element');
}
</script>
<script type="text/javascript" 
  src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit">
</script>

        {% else %}
            <li><a href="{% url 'streaming:login' %}" class="login-btn">Login</a></li>
            <li><a href="{% url 'streaming:signup' %}" class="signup-btn">Sign Up</a></li>
        {% endif %}
    </ul>
    
</nav>

<!-- Search & Filters -->
<div class="streaming-filter-bar">
  <input type="text" id="streamingSearch" placeholder="{% trans 'Search by title...' %}" />
  
  <select id="streamingCategory">
    <option value="">{% trans "All Categories" %}</option>
    {% for cat in categories %}
      <option value="{{ cat }}">{{ cat }}</option>
    {% endfor %}
  </select>

  <select id="streamingGenre" >
    <option value="">{% trans "All Genres" %}</option>
    {% for genre in genres %}
      <option value="{{ genre }}">{{ genre }}</option>
    {% endfor %}
  </select>

  <select id="streamingLanguage">
    <option value="">{% trans "All Languages" %}</option>
    {% for lang in languages %}
      <option value="{{ lang }}">{{ lang }}</option>
    {% endfor %}
  </select>

  <button id="streamingFilterBtn">{% trans "Apply Filter" %}</button>
</div>

<!-- Sections by Category -->
{% for category, items in categorized_contents.items %}
<div class="streaming-section">
  <h2>{{ category }}</h2>
  <div class="streaming-list">
    <ul>
      {% for content in items %}
        <li class="streaming-card"
            data-title="{{ content.title|lower }}"
            data-category="{{ content.get_category_display }}"
            data-genre="{{ content.genre }}"
            data-language="{{ content.language }}">
          
          {% if content.thumbnail %}
            <img src="{{ content.thumbnail.url }}" alt="{{ content.title }}" class="streaming-thumbnail" />
          {% else %}
            <div class="streaming-thumbnail-placeholder"></div>
          {% endif %}

          <!-- Title & Description: no translation -->
          <h3 class="no-translation">{{ content.title }}</h3>
          <p class="no-translation">Category: {{ content.get_category_display }}</p>
          <p class="no-translation">Genre: {{ content.genre }}</p>
          <p class="no-translation">Language: {{ content.language }}</p>
          <p class="no-translation">Release Date: {{ content.release_date }}</p>
          <p class="no-translation">Duration: {{ content.duration_minutes }} minutes</p>

          {% if content.video_file or content.video_url %}
            <a href="{% url 'streaming:watch_video' content.id %}" class="streaming-watch-btn">{% trans "Watch Now" %}</a>
          {% else %}
            <span class="streaming-no-video">{% trans "No video available" %}</span>
          {% endif %}
        </li>
      {% endfor %}
    </ul>
  </div>
</div>
{% endfor %}

{% if not categorized_contents %}
<p class="streaming-no-content">{% trans "No streaming content available yet." %}</p>
{% endif %}
{% endblock %}

<!-- Footer -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="social-icons">
            <a href="https://facebook.com" target="_blank" aria-label="Facebook">
                <i class="fab fa-facebook-f"></i>
            </a>
            <a href="https://twitter.com" target="_blank" aria-label="Twitter">
                <i class="fab fa-twitter"></i>
            </a>
            <a href="https://instagram.com" target="_blank" aria-label="Instagram">
                <i class="fab fa-instagram"></i>
            </a>
            <a href="https://linkedin.com" target="_blank" aria-label="LinkedIn">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </div>
    </div>
    <p>&copy; Qine Entertainment 2025. All rights reserved.</p>
</footer>

{% block extra_js %}
<script>
document.addEventListener("DOMContentLoaded", function() {
  const searchInput = document.getElementById("streamingSearch");
  const categoryFilter = document.getElementById("streamingCategory");
  const genreFilter = document.getElementById("streamingGenre");
  const languageFilter = document.getElementById("streamingLanguage");
  const filterBtn = document.getElementById("streamingFilterBtn");
  const cards = document.querySelectorAll(".streaming-card");

  function applyFilters() {
    const search = searchInput.value.toLowerCase().trim();
    const category = categoryFilter.value;
    const genre = genreFilter.value;
    const language = languageFilter.value;

    cards.forEach(card => {
      const title = card.dataset.title;
      const cardCategory = card.dataset.category;
      const cardGenre = card.dataset.genre;
      const cardLanguage = card.dataset.language;

      const matchSearch = !search || title.includes(search);
      const matchCategory = !category || cardCategory === category;
      const matchGenre = !genre || cardGenre === genre;
      const matchLanguage = !language || cardLanguage === language;

      if (matchSearch && matchCategory && matchGenre && matchLanguage) {
        card.style.display = "block";
      } else {
        card.style.display = "none";
      }
    });
  }

  searchInput.addEventListener("input", applyFilters);
  filterBtn.addEventListener("click", applyFilters);
});
</script>
{% endblock %}
