{% extends "admin/change_list.html" %}
{% load static %}

{% block content %}
<h1>Streaming Analytics Dashboard</h1>
<nav class="navbar">
    <div class="logo">
        <a href="{% url 'home' %}">
            <img src="{% static 'images/logo3.png' %}" alt="Cinema Logo" style="height:70px;">
        </a>
    </div>
    <ul class="nav-links">
        <li> <a href="{% url 'home' %}">Home</a></li>
        <li><a href="{% url 'cinema' %}">Events/Cinema</a></li>
        <li><a href="{% url 'streaming:streaming_home' %}">Streaming</a></li>
        <li><a href="{% url 'about' %}">About</a></li>
        <li><a href="{% url 'contact' %}">Contact</a></li>
        {% if user.is_authenticated %}
            <li><a href="{% url 'streaming:user_profile' %}" class="profile-btn"><i class="fas fa-user-circle"></i> {{ user.username }}</a></li>
            <li><a href="{% url 'streaming:logout' %}" class="logout-btn">Logout</a></li>
        {% else %}
            <li><a href="{% url 'streaming:login' %}" class="login-btn">Login</a></li>
            <li><a href="{% url 'streaming:signup' %}" class="signup-btn">Sign Up</a></li>
        {% endif %}
    </ul>
</nav>


<div style="margin-bottom: 20px;">
    <a class="button" href="{{ download_csv_url }}">Download Full Analytics CSV</a>
</div>

<table style="border-collapse: collapse; width: 60%; margin-bottom: 30px;">
    <tr>
        <th style="border: 1px solid #ccc; padding: 8px;">Metric</th>
        <th style="border: 1px solid #ccc; padding: 8px;">Value</th>
    </tr>
    <tr>
        <td style="border: 1px solid #ccc; padding: 8px;">Total Views</td>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ stats.total_views }}</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ccc; padding: 8px;">Unique Viewers</td>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ stats.unique_viewers }}</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ccc; padding: 8px;">Total Watch Time (Hours)</td>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ stats.total_watch_time_hours }}</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ccc; padding: 8px;">Average Watch Time per View (Hours)</td>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ stats.avg_watch_time_per_view }}</td>
    </tr>
    <tr>
        <td style="border: 1px solid #ccc; padding: 8px;">Completion Rate (%)</td>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ stats.completion_rate }}</td>
    </tr>
</table>

<h2>Top Regions</h2>
<table style="border-collapse: collapse; width: 40%;">
    <tr>
        <th style="border: 1px solid #ccc; padding: 8px;">Region</th>
        <th style="border: 1px solid #ccc; padding: 8px;">Percentage (%)</th>
    </tr>
    {% for region, percent in stats.top_regions.items %}
    <tr>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ region }}</td>
        <td style="border: 1px solid #ccc; padding: 8px;">{{ percent }}</td>
    </tr>
    {% endfor %}
</table>

{% endblock %}
